
// ==================== COMPREHENSIVE EMISSION DATA (93 ACTIVITIES) ====================

const emissionData = {
    scope1: {
        title: "Scope 1 - Ã‰missions Directes",
        categories: {
            "Combustibles fossiles": [
                {name: "Essence", unit: "litre", factor: 2.31},
                {name: "Diesel", unit: "litre", factor: 2.68},
                {name: "Gaz de PÃ©trole LiquÃ©fiÃ© - GPL", unit: "litre", factor: 1.51},
                {name: "Gaz naturel", unit: "mÂ³", factor: 2.04},
                {name: "Charbon", unit: "kg", factor: 2.40},
                {name: "Fioul domestique", unit: "litre", factor: 3.15},
                {name: "Fioul lourd", unit: "litre", factor: 3.20},
                {name: "KÃ©rosÃ¨ne", unit: "litre", factor: 2.51},
                {name: "Propane", unit: "litre", factor: 1.64},
                {name: "Butane", unit: "litre", factor: 1.53},
                {name: "Biocarburants", unit: "litre", factor: 0.50}
            ],
            "Gaz rÃ©frigÃ©rants et climatisation": [
                {name: "HFC (Hydrofluorocarbures)", unit: "kg", factor: 4430},
                {name: "PFC (Perfluorocarbures)", unit: "kg", factor: 10000},
                {name: "SF6 (Hexafluorure de soufre)", unit: "kg", factor: 23500},
                {name: "R-410A, R-134a, R-404A", unit: "kg", factor: 2088}
            ],
            "Processus industriels": [
                {name: "Ciment", unit: "kg", factor: 0.92},
                {name: "Chaux", unit: "kg", factor: 1.20},
                {name: "Ammoniac", unit: "kg", factor: 2.45},
                {name: "Acide nitrique", unit: "kg", factor: 6.80}
            ]
        }
    },
    scope2: {
        title: "Scope 2 - Ã‰missions Indirectes LiÃ©es Ã  l'Ã‰nergie",
        categories: {
            "Ã‰nergie": [
                {name: "Ã‰lectricitÃ© (Tunisie)", unit: "kWh", factor: 0.468},
                {name: "Ã‰lectricitÃ© (autre pays)", unit: "kWh", factor: 0.400},
                {name: "Chauffage urbain", unit: "kWh", factor: 0.15},
                {name: "Refroidissement urbain", unit: "kWh", factor: 0.12},
                {name: "Vapeur", unit: "kWh", factor: 0.10},
                {name: "Ã‰lectricitÃ© autoconsommÃ©e", unit: "kWh", factor: 0.0}
            ]
        }
    },
    scope3: {
        title: "Scope 3 - Autres Ã‰missions Indirectes",
        categories: {
            "CatÃ©gorie 1 : Biens et services achetÃ©s": [
                {name: "Papier", unit: "kg", factor: 1.20},
                {name: "Carton", unit: "kg", factor: 0.80},
                {name: "Plastique", unit: "kg", factor: 3.50},
                {name: "MÃ©tal", unit: "kg", factor: 2.70},
                {name: "Ã‰lectronique", unit: "unitÃ©s", factor: 50.0},
                {name: "Mobilier", unit: "unitÃ©s", factor: 100.0},
                {name: "Fournitures de bureau", unit: "kg", factor: 2.50},
                {name: "Produits chimiques", unit: "kg", factor: 4.20},
                {name: "VÃªtements de travail", unit: "kg", factor: 8.50}
            ],
            "CatÃ©gorie 2 : Biens d'Ã©quipement": [
                {name: "Ordinateurs", unit: "unitÃ©s", factor: 200.0},
                {name: "Serveurs", unit: "unitÃ©s", factor: 500.0},
                {name: "VÃ©hicules achetÃ©s", unit: "unitÃ©s", factor: 5000.0},
                {name: "Machines industrielles", unit: "unitÃ©s", factor: 1500.0},
                {name: "BÃ¢timents construits", unit: "mÂ²", factor: 150.0}
            ],
            "CatÃ©gorie 3 : Ã‰nergie non incluse": [
                {name: "Production de combustibles", unit: "litre", factor: 0.30},
                {name: "Transport et distribution d'Ã©nergie", unit: "kWh", factor: 0.05}
            ],
            "CatÃ©gorie 4 : Transport amont": [
                {name: "Camion", unit: "km-t", factor: 0.09},
                {name: "Train de marchandises", unit: "km-t", factor: 0.02},
                {name: "Bateau", unit: "km-t", factor: 0.01},
                {name: "Avion cargo", unit: "km-t", factor: 0.50},
                {name: "Fret maritime", unit: "TEU-km", factor: 0.008}
            ],
            "CatÃ©gorie 5 : DÃ©chets": [
                {name: "DÃ©chets non dangereux", unit: "kg", factor: 0.50},
                {name: "DÃ©chets dangereux", unit: "kg", factor: 1.50},
                {name: "DÃ©chets recyclÃ©s", unit: "kg", factor: 0.15},
                {name: "DÃ©chets incinÃ©rÃ©s", unit: "kg", factor: 2.50},
                {name: "DÃ©chets en dÃ©charge", unit: "kg", factor: 1.80},
                {name: "DÃ©chets organiques/compost", unit: "kg", factor: 0.30}
            ],
            "CatÃ©gorie 6 : DÃ©placements professionnels": [
                {name: "Voiture personnelle", unit: "km", factor: 0.21},
                {name: "Voiture de location", unit: "km", factor: 0.21},
                {name: "Avion - court courrier", unit: "km", factor: 0.000255},
                {name: "Avion - moyen courrier", unit: "km", factor: 0.000175},
                {name: "Avion - long courrier", unit: "km", factor: 0.000155},
                {name: "Train", unit: "km", factor: 0.000041},
                {name: "Bus", unit: "km", factor: 0.000089},
                {name: "Taxi", unit: "km", factor: 0.000210},
                {name: "MÃ©tro/Tramway", unit: "km", factor: 0.000050},
                {name: "HÃ´tel", unit: "nuitÃ©es", factor: 25.0},
                {name: "Restaurant", unit: "repas", factor: 2.50}
            ],
            "CatÃ©gorie 7 : DÃ©placements domicile-travail": [
                {name: "Voiture", unit: "km", factor: 0.21},
                {name: "Transport en commun", unit: "km", factor: 0.000089},
                {name: "Moto/Scooter", unit: "km", factor: 0.150},
                {name: "VÃ©lo Ã©lectrique", unit: "km", factor: 0.010},
                {name: "Covoiturage", unit: "km", factor: 0.105}
            ],
            "CatÃ©gorie 8 : Actifs louÃ©s (amont)": [
                {name: "BÃ¢timents louÃ©s", unit: "mÂ²", factor: 0.15},
                {name: "VÃ©hicules louÃ©s", unit: "km", factor: 0.21},
                {name: "Ã‰quipements louÃ©s", unit: "unitÃ©s", factor: 50.0}
            ],
            "CatÃ©gorie 9 : Transport aval": [
                {name: "Livraison clients - camion", unit: "km-t", factor: 0.09},
                {name: "Livraison clients - avion", unit: "km-t", factor: 0.50},
                {name: "Distribution finale", unit: "km", factor: 0.21}
            ],
            "CatÃ©gorie 10 : Transformation": [
                {name: "Ã‰nergie de transformation", unit: "kWh", factor: 0.468},
                {name: "MatiÃ¨res de transformation", unit: "kg", factor: 2.50}
            ],
            "CatÃ©gorie 11 : Utilisation des produits": [
                {name: "Ã‰lectricitÃ© consommÃ©e", unit: "kWh", factor: 0.468},
                {name: "Carburant consommÃ©", unit: "litre", factor: 2.31}
            ],
            "CatÃ©gorie 12 : Fin de vie": [
                {name: "Recyclage des produits", unit: "kg", factor: 0.20},
                {name: "IncinÃ©ration des produits", unit: "kg", factor: 2.50},
                {name: "Enfouissement des produits", unit: "kg", factor: 1.80}
            ],
            "CatÃ©gorie 13 : Actifs louÃ©s (aval)": [
                {name: "BÃ¢timents louÃ©s Ã  des tiers", unit: "mÂ²", factor: 0.15}
            ],
            "CatÃ©gorie 14 : Franchises": [
                {name: "Ã‰missions des franchises", unit: "tCO2e", factor: 1.0}
            ],
            "CatÃ©gorie 15 : Investissements": [
                {name: "Actions et obligations", unit: "â‚¬", factor: 0.00025},
                {name: "PrÃªts", unit: "â‚¬", factor: 0.00015}
            ],
            "Autres catÃ©gories transversales": [
                {name: "Eau potable", unit: "mÂ³", factor: 0.30},
                {name: "Eaux usÃ©es", unit: "mÂ³", factor: 0.50},
                {name: "NumÃ©rique - Data centers", unit: "kWh", factor: 0.468},
                {name: "NumÃ©rique - Cloud computing", unit: "Go", factor: 0.001},
                {name: "TÃ©lÃ©communications", unit: "minutes/Go", factor: 0.0001},
                {name: "PublicitÃ© et marketing", unit: "â‚¬", factor: 0.0005},
                {name: "Services bancaires", unit: "transactions", factor: 0.05},
                {name: "Assurances", unit: "â‚¬", factor: 0.00020}
            ]
        }
    }
};

let calculationResults = {scope1: 0, scope2: 0, scope3: 0, total: 0, details: {}};
let pieChart = null;
let barChart = null;

// ==================== INITIALIZATION ====================
window.addEventListener('DOMContentLoaded', () => {
    renderEmissionForms();
    loadTheme();
    animateShooting();
});

// ==================== RENDERING ====================
function renderEmissionForms() {
    renderScopeForm('scope1');
    renderScopeForm('scope2');
    renderScopeForm('scope3');
    renderFactorsTable();
}

function renderScopeForm(scopeName) {
    const scope = emissionData[scopeName];
    const container = document.getElementById(`${scopeName}-content`);
    let html = '';

    for (const [category, activities] of Object.entries(scope.categories)) {
        html += `
            <div class="category-section">
                <div class="category-title">ðŸ“Œ ${category}</div>
                <div class="category-items">
        `;

        activities.forEach((activity, idx) => {
            const inputId = `${scopeName}_${category}_${idx}`;
            html += `
                <div class="activity-input">
                    <label>${activity.name}</label>
                    <input type="number" id="${inputId}" placeholder="0" min="0" step="0.01">
                    <small>${activity.unit} Ã— ${activity.factor}</small>
                </div>
            `;
        });

        html += `</div></div>`;
    }

    container.innerHTML = html;
}

function renderFactorsTable() {
    const container = document.getElementById('factors-content');
    let html = '<table><thead><tr><th>Scope</th><th>CatÃ©gorie</th><th>ActivitÃ©</th><th>UnitÃ©</th><th>Facteur (kg CO2e)</th></tr></thead><tbody>';

    ['scope1', 'scope2', 'scope3'].forEach(scopeName => {
        const scope = emissionData[scopeName];
        for (const [category, activities] of Object.entries(scope.categories)) {
            activities.forEach(activity => {
                html += `<tr><td>${scopeName.replace('scope', 'Scope ')}</td><td>${category}</td><td>${activity.name}</td><td>${activity.unit}</td><td><input type="number" value="${activity.factor}" class="factor-input" style="width:100%;"></td></tr>`;
            });
        }
    });

    html += '</tbody></table>';
    container.innerHTML = html;
}
